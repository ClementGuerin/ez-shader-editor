<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>

<title>Shader Editor</title>


<link rel="stylesheet" type="text/css" href="css/w2ui.dark1.css"/>



<script type="text/javascript" src="js/external/jquery-2.1.1.min.js"></script>
<script type="text/javascript" src="js/external/w2ui.cutted-1.4.2.js"></script>
<script type="text/javascript" src="js/external/dat.gui.js"></script>

<script type="text/javascript" src="js/external/gl-matrix.js"></script>
<script type="text/javascript" src="js/external/litegl.js"></script>
<script type="text/javascript" src="js/external/litegraph.js"></script>
<script>
    $(function () {
        $('#layout').w2layout({
            name: 'main_layout',
            panels: [
                { type: 'top', size: 30 }, // so far top not used
                { type: 'left', size: '25%', resizable: true },
                { type: 'main' },
                //{ type: 'preview', size: 100, resizable: true, content: 'preview' },
                //{ type: 'lower_right', size: 300, resizable: true },
                //{ type: 'bottom', size: 50, resizable: true, content: 'bottom' }
                { type: 'lower_left', size: '60%', resizable: true,
                    tabs: {
                        active: 'Details',
                        tabs: [
                            { id: 'Details', caption: 'Details' }
                        ],
                        onClick: function (event) {
                            $('#tab-content').html('Tab: ' + event.target);
                        }
                    }
                },
                { type: 'right', size: '25%', resizable: true,
                    tabs: {
                        active: 'Palette',
                        tabs: [
                            { id: 'Palette', caption: 'Palette' }
                        ],
                        onClick: function (event) {
                            $('#tab-content').html('Tab: ' + event.target);
                        }
                    }
                },

            ],
            resize_cancel: false
        });
    });
</script>
<script type="text/javascript">
    function init() {


        var container = $("#layout_main_layout_panel_left div.w2ui-panel-content");
        var gl = GL.create({width: container.width(), height: container.height()});
        container.append(gl.canvas);
        gl.animate();
        //build the mesh
        var cube_mesh = GL.Mesh.cube({size: 10});
        var cam_pos = vec3.fromValues(100, 0, 100);
        //create basic matrices for cameras and transformation
        var persp = window.persp = mat4.create();
        var view = window.view = mat4.create();
        var mvp = window.mvp = mat4.create();
        var temp = mat4.create();
        var objects = [];


        container = $("#layout_main_layout_panel_main div.w2ui-panel-content");
        var h = container.height();
        var w = container.width();
        var html = "<canvas class='graph' width='" + w + "' height='" + h + "'></canvas>";
        container.append(html);
        var graph = new LGraph();
        var gcanvas = new LGraphCanvas(container.children()[0], graph);
        gcanvas.background_image = "img/grid.png";
        gcanvas.drawBackCanvas();

        function resize() {
            var parent = $("#layout_main_layout_panel_main div.w2ui-panel-content");
            var w = parent.width();
            var h = parent.height();
            gcanvas.resize(w, h);

            parent = gl.canvas.parentNode;
            w = $(parent).width();
            h = $(parent).height();
            if (w == 0 || h == 0)
                return;
            if (w == gl.canvas.width && h == gl.canvas.height)
                return;
            gl.canvas.width = w;
            gl.canvas.height = h;
            gl.viewport(0, 0, w, h);
            mat4.perspective(persp, 45 * DEG2RAD, gl.canvas.width / gl.canvas.height, 0.1, 1000);


        }

        //create the rendering context
        w2ui['main_layout'].on('resize', function (target, data) {
            data.onComplete = function () {
                var width = w2ui['main_layout'].get('left').width;
                var height = w2ui['main_layout'].get('left').height;
                resize();
            }
        });

        for (var x = -10; x <= 10; x++)
            for (var y = -5; y <= 5; y++)
                objects.push({ color: [0.3, 0.3, 0.3, 1.0], model: mat4.translationMatrix([x * 12, y * 12, 0]), mesh: cube_mesh });
        //set the camera perspective
        mat4.perspective(persp, 45 * DEG2RAD, gl.canvas.width / gl.canvas.height, 0.1, 1000);
        //mat4.ortho(persp, -50,50,-50,50,0,500); //ray doesnt work in perspective
        function getClosestObject(x, y) {
            var RT = new GL.Raytracer(view, persp);
            var ray = RT.getRayForPixel(x, y);
            var closest_object = null;
            var closest_t = 100000000;
            for (var i in objects) {
                var object = objects[i];
                var result = Raytracer.hitTestBox(cam_pos, ray, BBox.getMin(object.mesh.bounding), BBox.getMax(object.mesh.bounding), object.model);
                if (result && closest_t > result.t) {
                    closest_object = object;
                    closest_t = result.t;
                }
            }
            return closest_object;
        }

        gl.captureMouse();
        gl.onmousemove = function (e) {
            var object = getClosestObject(e.canvasx, gl.canvas.height - e.canvasy);
            if (object && object.color[0] != 1)
                vec3.random(object.color);
        }
        //basic phong shader
        var shader = new Shader('\
				precision highp float;\
				attribute vec3 a_vertex;\
				attribute vec3 a_normal;\
				varying vec3 v_normal;\
				uniform mat4 u_mvp;\
				uniform mat4 u_modelt;\
				void main() {\
					v_normal = (u_modelt * vec4(a_normal,1.0)).xyz;\
					gl_Position = u_mvp * vec4(a_vertex,1.0);\
				}\
				', '\
				precision highp float;\
				varying vec3 v_normal;\
				uniform vec3 u_lightvector;\
				uniform vec4 u_color;\
				void main() {\
				  vec3 N = normalize(v_normal);\
				  gl_FragColor = u_color * max(0.0, dot(u_lightvector,N));\
				}\
			');
        //generic gl flags and settings
        gl.clearColor(0.01, 0.01, 0.01, 1);
        gl.enable(gl.DEPTH_TEST);
        gl.enable(gl.CULL_FACE);
        var modelt = mat4.create();
        //rendering loop
        gl.ondraw = function () {
            gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
            var L = vec3.normalize(vec3.create(), [1.5, 1.1, 1.4]);
            mat4.lookAt(view, cam_pos, [0, 0, 0], [0, 1, 0]);
            //create modelview and projection matrices
            for (var i in objects) {
                var model = objects[i].model;
                mat4.multiply(temp, view, model); //modelview
                mat4.multiply(mvp, persp, temp); //modelviewprojection
                //compute rotation matrix for normals
                mat4.toRotationMat4(modelt, model);
                //render mesh using the shader
                shader.uniforms({
                    u_color: objects[i].color,
                    u_lightvector: L,
                    u_modelt: modelt,
                    u_mvp: mvp
                }).draw(objects[i].mesh);
            }
        };
        //update loop
        gl.onupdate = function (dt) {
            cam_pos[0] = Math.sin(getTime() * 0.001) * 100;
            /*
             var mat = mat4.create();
             mat4.rotateY(mat,mat,dt*0.2);
             mat4.multiplyVec3( cam_pos, mat, cam_pos);
             */
            //rotate world
            //mat4.rotateY(model,model,dt*0.2);
        };
    }

</script>
<script type="text/javascript">

    var FizzyText = function () {
        this.message = 'dat.gui';
        this.speed = 0.8;
        this.displayOutline = false;
        this.noiseStrength = 10;
        this.growthSpeed = -3;
        this.maxSize = 24;
        this.color0 = "#ffae23"; // CSS string
        this.color1 = [ 0, 128, 255 ]; // RGB array
        this.color2 = [ 0, 128, 255, 0.3 ]; // RGB with alpha
        this.color3 = { h: 350, s: 0.9, v: 0.3 }; // Hue, saturation, value

        this.explode = function () {
        };
        // Define render logic ...
    };

    $(window).load(function () {
        var customContainer = $("#layout_main_layout_panel_lower_left div.w2ui-panel-content");
        var text = new FizzyText();
        var gui = new dat.GUI({
            resizable : false,
            hideable : false
        });
        gui.width = customContainer.width();
        gui.add(text, 'message');
        gui.add(text, 'speed', -5, 5);
        gui.add(text, 'displayOutline');
        gui.add(text, 'explode');
        gui.addColor(text, 'color0');
        gui.addColor(text, 'color1');
        gui.addColor(text, 'color2');
        gui.addColor(text, 'color3');
        var f1 = gui.addFolder('Flow Field');
        f1.add(text, 'speed');
        f1.add(text, 'noiseStrength');

        var f2 = gui.addFolder('Letters');
        f2.add(text, 'growthSpeed');
        f2.add(text, 'maxSize');
        f2.add(text, 'message');

        gui.add(text, 'noiseStrength').step(5); // Increment amount
        gui.add(text, 'growthSpeed', -5, 5); // Min and max
        gui.add(text, 'maxSize').min(0).step(0.25); // Mix and match

        f2.open();

        customContainer[0].appendChild(gui.domElement);
        $("#layout_main_layout_panel_lower_left div.w2ui-panel-content")[0].appendChild(gui.domElement);

        var text = new FizzyText();
        var gui2 = new dat.GUI({
            resizable : false,
            hideable : false
        });
        gui2.width = customContainer.width();
        gui2.add(text, 'message');
        gui2.add(text, 'speed', -5, 5);
        gui2.add(text, 'displayOutline');
        gui2.add(text, 'explode');
        gui2.addColor(text, 'color0');
        gui2.addColor(text, 'color1');
        gui2.addColor(text, 'color2');
        gui2.addColor(text, 'color3');


        gui.add(text, 'noiseStrength').step(5); // Increment amount
        gui.add(text, 'growthSpeed', -5, 5); // Min and max
        gui.add(text, 'maxSize').min(0).step(0.25); // Mix and match

        f2.open();

        customContainer[0].appendChild(gui2.domElement);
        $("#layout_main_layout_panel_right div.w2ui-panel-content")[0].appendChild(gui2.domElement);
    });

</script>

<link rel="stylesheet" type="text/css" href="css/style.css"/>
</head>
<body>
<div id="layout"
     style="position: absolute; top: 0px; left: 0px; bottom: 0px; right: 0px;"></div>
<script>
    $(window).load(function () {
        init();
    });
</script>
</body>
</html>

<!--<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"-->
<!--"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">-->
<!--<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">-->
<!--<head>-->
<!--<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>-->

<!--<title>VI-GUI</title>-->

<!--<link href="css/vigui.css" media="screen" rel="stylesheet" type="text/css">-->


<!--<script type="text/javascript" src="js/lib/dat.gui.min.js" ></script>-->
<!--<script type="text/javascript" src="js/vigui.js"></script>-->
<!--<script type="text/javascript">-->
<!--function init()-->
<!--{-->
<!--var ui = new VI.GUI({id:"myGui"});-->
<!--ui.splitSection({id:"mid",parent_id:"myGui", direction:"horizontal", size:[300, null]});-->
<!--ui.splitSection({id:"column",parent_id:"mid_left", direction:"vertical", size:[null, 300]});-->
<!--}-->
<!--</script>-->


<!--</head>-->
<!--<body>-->

<!--<script>init();</script>-->
<!--</body>-->
<!--</html>-->